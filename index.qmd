---
title: "Выборы в России из-за границы"
execute:
  echo: false 
  warning: false
subtitle: "Как голосуют на российских выборах граждане РФ проживающие за границей"
author: "Илья Тищенко"
---

# Коротко

В 2020 году мне стало интересно, как проголосовала заграница на референдуме по изменению конституции. В результате, родилась [вот такая](https://rpubs.com/vearlen/obnulis "Результаты российского референдума 2020 года") короткая заметка. В 2024 прошли выборы в России. На основе данных собранных мной по заграничному голосованию в [Новой газете Европа](https://novayagazeta.eu/articles/2024/03/20/vosstanie-relokantov?fbclid=IwAR01A66cysVn84QduPZMTBjP3c1cIEfAVLW_drlLD7OGn7bNYmAMvk7sNck) вышла статья по участкам за границей. За что большое спасибо Алесе Соколовой, [подписывайтесь на её канал](https://t.me/research_for_democracy).

Тут кратко некоторые вещи, заинтересовавшие лично меня в процессе работы над данными, в дополнение к статье.

-   Выросла ли явка? Мы все видели огромные очереди в избирательные участки, многие люди не попали внутрь. Краткий ответ в абсолютных значениях - нет.

-   Какой "демографический" состав голосующих за рубежом? Почему на всех прошлых выборых за границей результат, за исключением 20-го и 24-го годов, в среднем выше чем официальный в России? В основном за счет военных или территорий контролируемых Россией, как ни странно и за границей есть вбросы.

-   Менялось ли как-то распределение голосующих от года к году и как? Менялось, в 2018 году на выборы пришел очень маленький процент людей голосующих против Путина, в 2024 году таких было сильно больше, а людей за Путина пришло меньше.

# Количество людей пришедших на голосование

```{r}
library(tidyverse)
library(plotly)
library(cowplot)
library(ggstar)
library(DT)
library('ggrepel')
library(modelsummary)
# options(scipen = 999)
RU04_24 <- read.csv("Data/RU04_24_Russia.csv")

# official results PU, ME, Referendum
pu <- tibble(year=c(2004,2008,2012,2018,2020, 2024),
             rat=c(71.3,70.28,63.6,76.7,78.45, 87),
             en_country = rep("Официальный результат 
выборов в РФ",6)) %>% 
  mutate(rat_dec = rat*0.01)
```

Как видно на @fig-total_voters общее абсолютное количество голосующих меньше чем в 2018 году, по-видимому, основная причина - закрытие участков для голосования.

```{r total voters function}
#| label: fig-total_voters
#| fig-cap: "Общее кол-во проголосовавших"

total_voters <- function(sel_region = NA, sel_country = NA){
  if(is.na(sel_region)){
    sel_region = all_of(RU04_24$region)
    sel_region_label = NULL
  }  else {
    sel_region
    sel_region_label = sel_region
  }

  if(is.na(sel_country)){
    sel_country = all_of(RU04_24$en_country)
    sel_country_label = NULL
  } else {
    sel_country
    sel_country_label = sel_country
  }
#   
  total_voters <- RU04_24 %>% 
    filter(region %in% c(sel_region)) %>%
    filter(en_country %in% c(sel_country)) %>%
    filter(Label %in% c("Число недействительных избирательных бюллетеней",
                        "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
    group_by(year) %>% 
    summarise(total = sum(number))
  
  g1 <- total_voters %>% 
    ggplot(aes(x=year,y=total))+
    geom_bar(position = 'stack',stat='identity', fill='#0084D7')+
    geom_text(aes(label=total,y=total*0.84),vjust = 1.5,color='grey99',size=3)+
    coord_flip()+
    theme_cowplot()+
    theme_minimal_grid(font_size = 9)+
    labs(y="",x="",fill="",title=paste0("Количество проголосовавших за рубежом ",sel_region_label,"  ",sel_country_label),
         subtitle= "Кол-во проголосовавших за рубежом")+
    scale_x_continuous(breaks = c(2024,2020,2018,2012,2008, 2004))+
    scale_y_continuous(labels = scales::comma)+
    theme(legend.position = 'top',
          axis.line.x = element_blank(),
          axis.ticks.x = element_blank(),
          plot.subtitle = element_text(size=10,color='grey90',hjust=1))
  # g1
  ggplotly(g1)
}
total_voters()
```

Тем не менее, как и многие я видел огромные очереди в избирательные участки в Вене, [Берлине](https://youtu.be/JmQw0TTWopU?si=JmhoYO32GIe0qt16), [Париже](https://www.youtube.com/live/FfY5mVx6Ir8?si=2w4nwVIF3_f40x3a&t=1688), Лондоне и [прочих](https://youtu.be/PdUrk4EEZUk?si=zWqv3t0ERDLsFteK) [городах](https://youtu.be/MMVJ-81B_h0?si=2CYBKrxQgn0TA_Xp). Как изменилась явка на зарубежных участках? На @fig-turnout по оси Х показано изменение явки в 2024 по сравнению с 2018, положительные значения - людей пришло больше, размер точки - общее кол-во людей пришедших на участок.

```{r turnout}
#| label: fig-turnout
#| fig-cap: "Разница в явке между 2018 и 2024 годом"
#| fig-height: 9
RU_total_UIK <- RU04_24 %>% 
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(UIK,year,en_country,Location) %>% 
  summarise(total = sum(number)) 

total_voters <- RU04_24 %>% 
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(UIK,year) %>% 
  summarise(total = sum(number))

gov_voters <- RU04_24 %>% 
  filter(Label %in% c("yes",
                      "Путин Владимир Владимирович",
                      "Медведев Дмитрий Анатольевич"
  )) %>%
  group_by(UIK,year) %>% 
  summarize(gov_total = sum(number))

reject_voters <- RU04_24 %>% 
  filter(Label %in% c("Rejected.ballots",
                      "Число недействительных избирательных бюллетеней")) %>% 
  group_by(UIK,year) %>% 
  summarize(reject_total = sum(number))

against_voters <- RU04_24 %>% 
  filter(Label %in% c("Глазьев Сергей Юрьевич",
                      "Против всех",
                      "Малышкин Олег Александрович",
                      "Миронов Сергей Михайлович",
                      "Хакамада Ирина Муцуовна",
                      "Харитонов Николай Михайлович",
                      "Богданов Андрей Владимирович",
                      "Жириновский Владимир Вольфович",
                      "Зюганов Геннадий Андреевич",
                      "Прохоров Михаил Дмитриевич",
                      "Бабурин Сергей Николаевич",
                      "Грудинин Павел Николаевич",
                      "Собчак Ксения Анатольевна",
                      "Сурайкин Максим Александрович",
                      "Титов Борис Юрьевич",
                      "Явлинский Григорий Алексеевич",
                      "Даванков Владислав Андреевич",
                      "Слуцкий Леонид Эдуардович",
                      "Харитонов Николай Михайлович",
                      "no")) %>% 
  group_by(UIK,year) %>% 
  summarize(against_total = sum(number))


sum_voters <- total_voters %>% 
  left_join(gov_voters) %>% 
  left_join(reject_voters) %>% 
  left_join(against_voters) %>% 
  mutate(gov_ratio = gov_total/total,
         reject_ratio = reject_total/total,
         against_ratio = against_total/total) %>% 
  mutate(gov_flag = if_else(gov_ratio > 0.5, "Y","N"))

df_turnout_18_24 <- 
RU_total_UIK %>% 
  filter(year %in% c(2018, 2024)) %>% 
  mutate(Location = str_trim(Location)) %>%
  pivot_wider(id_cols = c(UIK,en_country,Location),names_from = year,values_from = total) %>% 
  mutate(diff = `2024`- `2018`, ratio = round(diff/`2018`*100,0)) %>% 
  filter(!is.na(ratio)) %>% 
  left_join(filter(sum_voters,year==2024)) %>% 
  mutate(Location = if_else(is.na(Location),as.character(UIK),Location)) 
  
  
# ggplot(aes(x=reorder(Location,-ratio),y=ratio,color=gov_flag))+
#   geom_point(aes(
#     text = paste0(
#       en_country,
#       '<br>',
#       Location,
#       '<br>2018: ',
#       `2018`,
#       '<br>2024: ',
#       `2024`,
#       '<br>',
#       ratio,'%',
#       '<br> gov ratio: ', round(gov_ratio,2)
#   ),
#   size=`2024`,
#   alpha=0.6,
#   ))+
#   coord_flip()+
#   labs(x="",y="Показана разница явки в процентах между 2018 и 2024 годом, данные ЦИК",
#        title = "Сравнение явки на выборах 2018 и 2024 года",
#        color="За Путина",alpha="")+
#   theme_minimal()+
#   theme(plot.caption = element_text(size=10,hjust=0,vjust=0))
# g1

# ggplotly(g1, tooltip = 'text') 
pal <- c('brown','#0084D7')
pal <- setNames(pal,c('Y','N'))
p <-
  plot_ly(
    df_turnout_18_24,
    y = ~ reorder(Location, -ratio),
    x = ~ ratio,
    size = ~ `2024`,
    alpha = 0.6,
    color = ~ gov_flag,
    colors=pal,
    text = ~paste("Страна: ",en_country,
                  '<br>УИК: ', Location,'/',UIK,
                  '<br>Пришло',
                  '<br>  \'18:',`2018`,
                  '<br>  \'24:',`2024` ,
                  '<br>разница: ', ratio,
                  '%<br>за Путина: ',round(gov_ratio*100,0),'%'),
    hoverinfo = 'text'
  ) %>% 
  add_markers(sizes = c(30,1000))

p %>% layout(yaxis=list(title=""),xaxis=list(title="Разница в количестве людей 2018 и 2024 гг., %"))
```

Пропускная способность

# Демографический состав голосующих

Кол-во военных \> результат

Вбросы

# Динамика голосования

Изменение распределения

Кто пришел когда, кто придет в 2030?

# Данные

Если есть какие-то мысли пишите мне в телеграм @vearlen.
