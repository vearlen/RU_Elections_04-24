---
title: "Выборы в России из-за границы"
execute:
  echo: false 
  warning: false
subtitle: "Как голосуют на российских выборах граждане РФ проживающие за границей"
author: "Илья Тищенко"
fig-responsive: false
---

# Коротко

В 2020 году мне стало интересно, как проголосовала заграница на референдуме по изменению конституции. В результате, родилась [вот такая](https://rpubs.com/vearlen/obnulis "Результаты российского референдума 2020 года") короткая заметка. В 2024 прошли выборы в России. На основе данных собранных мной по заграничному голосованию в [Новой газете Европа](https://novayagazeta.eu/articles/2024/03/20/vosstanie-relokantov?fbclid=IwAR01A66cysVn84QduPZMTBjP3c1cIEfAVLW_drlLD7OGn7bNYmAMvk7sNck) вышла статья по участкам за границей. За что большое спасибо Алесе Соколовой, [подписывайтесь на её канал](https://t.me/research_for_democracy).

Тут кратко некоторые вещи, заинтересовавшие лично меня в процессе работы над данными, в дополнение к статье.

-   Выросла ли явка? Мы все видели огромные очереди в избирательные участки, многие люди не попали внутрь. Краткий ответ в абсолютных значениях - нет.

-   Какой "демографический" состав голосующих за рубежом? Почему на всех прошлых выборых за границей результат, за исключением 20-го и 24-го годов, в среднем выше чем официальный в России? В основном за счет военных или территорий контролируемых Россией, как ни странно и за границей есть вбросы.

-   Менялось ли как-то распределение голосующих от года к году и как? Менялось, в 2018 году на выборы пришел очень маленький процент людей голосующих против Путина, в 2024 году таких было сильно больше, а людей за Путина пришло меньше.

# Количество людей пришедших на голосование

```{r}
library(tidyverse)
library(plotly)
library(cowplot)
library(ggstar)
library(DT)
library('ggrepel')
library(modelsummary)
# options(scipen = 999)
RU04_24 <- read.csv("Data/RU04_24_Russia.csv")

# official results PU, ME, Referendum
pu <- tibble(year=c(2004,2008,2012,2018,2020, 2024),
             rat=c(71.3,70.28,63.6,76.7,78.45, 87),
             en_country = rep("Официальный результат 
выборов в РФ",6)) %>% 
  mutate(rat_dec = rat*0.01)
```

Как видно на @fig-total_voters общее абсолютное количество голосующих меньше чем в 2018 году, по-видимому, основная причина - закрытие участков для голосования.

```{r total voters function}
#| label: fig-total_voters
#| fig-cap: "Turnout abroad for Russian elections"

total_voters_fn <- function(sel_region = NA, sel_country = NA){
  if(is.na(sel_region)){
    sel_region = all_of(RU04_24$region)
    sel_region_label = NULL
  }  else {
    sel_region
    sel_region_label = sel_region
  }

  if(is.na(sel_country)){
    sel_country = all_of(RU04_24$en_country)
    sel_country_label = NULL
  } else {
    sel_country
    sel_country_label = sel_country
  }
#   
  total_voters <- RU04_24 %>% 
    filter(region %in% c(sel_region)) %>%
    filter(en_country %in% c(sel_country)) %>%
    filter(Label %in% c("Число недействительных избирательных бюллетеней",
                        "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
    group_by(year) %>% 
    summarise(total = sum(number))
  
  g1 <- total_voters %>% 
    ggplot(aes(x=year,y=total))+
    geom_bar(position = 'stack',stat='identity', fill='#0084D7')+
    geom_text(aes(label=total,y=total*0.84),vjust = 1.5,color='grey99',size=3)+
    coord_flip()+
    theme_cowplot()+
    theme_minimal_vgrid(font_size = 9)+
    labs(y="",x="",fill="",title=paste0("Turnout abroad Russia ",sel_region_label,"  ",sel_country_label),
         subtitle= "")+
    scale_x_continuous(breaks = c(2024,2020,2018,2012,2008, 2004),
                       expand = expansion(0.1,0))+
    scale_y_continuous(labels = scales::comma,expand = expansion(0.01,0.2))+
    theme(legend.position = 'top',
          axis.line = element_blank(),
          axis.ticks.x = element_blank(),
          plot.subtitle = element_text(size=10,color='grey90',hjust=1),
          axis.ticks = element_blank())
  # g1
  ggplotly(g1)
}
total_voters_fn()
```

Тем не менее, как и многие я видел огромные очереди в избирательные участки в Вене, [Берлине](https://youtu.be/JmQw0TTWopU?si=JmhoYO32GIe0qt16), [Париже](https://www.youtube.com/live/FfY5mVx6Ir8?si=2w4nwVIF3_f40x3a&t=1688), Лондоне и [прочих](https://youtu.be/PdUrk4EEZUk?si=zWqv3t0ERDLsFteK) [городах](https://youtu.be/MMVJ-81B_h0?si=2CYBKrxQgn0TA_Xp). Как изменилась явка на зарубежных участках? На @fig-turnout по оси Х показано изменение явки в 2024 по сравнению с 2018, положительные значения - людей пришло больше 2024, размер точки - общее кол-во людей пришедших на участок.

```{r turnout_calc}
RU_total_UIK <- RU04_24 %>% 
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(UIK,year,en_country,Location) %>% 
  summarise(total = sum(number)) 

total_voters <- RU04_24 %>% 
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(UIK,year) %>% 
  summarise(total = sum(number))

gov_voters <- RU04_24 %>% 
  filter(Label %in% c("yes",
                      "Путин Владимир Владимирович",
                      "Медведев Дмитрий Анатольевич"
  )) %>%
  group_by(UIK,year) %>% 
  summarize(gov_total = sum(number))

reject_voters <- RU04_24 %>% 
  filter(Label %in% c("Rejected.ballots",
                      "Число недействительных избирательных бюллетеней")) %>% 
  group_by(UIK,year) %>% 
  summarize(reject_total = sum(number))

against_voters <- RU04_24 %>% 
  filter(Label %in% c("Глазьев Сергей Юрьевич",
                      "Против всех",
                      "Малышкин Олег Александрович",
                      "Миронов Сергей Михайлович",
                      "Хакамада Ирина Муцуовна",
                      "Харитонов Николай Михайлович",
                      "Богданов Андрей Владимирович",
                      "Жириновский Владимир Вольфович",
                      "Зюганов Геннадий Андреевич",
                      "Прохоров Михаил Дмитриевич",
                      "Бабурин Сергей Николаевич",
                      "Грудинин Павел Николаевич",
                      "Собчак Ксения Анатольевна",
                      "Сурайкин Максим Александрович",
                      "Титов Борис Юрьевич",
                      "Явлинский Григорий Алексеевич",
                      "Даванков Владислав Андреевич",
                      "Слуцкий Леонид Эдуардович",
                      "Харитонов Николай Михайлович",
                      "no")) %>% 
  group_by(UIK,year) %>% 
  summarize(against_total = sum(number))


sum_voters <- total_voters %>% 
  left_join(gov_voters) %>% 
  left_join(reject_voters) %>% 
  left_join(against_voters) %>% 
  mutate(gov_ratio = gov_total/total,
         reject_ratio = reject_total/total,
         against_ratio = against_total/total) %>% 
  mutate(gov_flag = if_else(gov_ratio > 0.5, "Y","N"))

```

```{r turnout_fig}
#| label: fig-turnout
#| fig-cap: "Difference in turnout 2018 and 2024"
#| fig-height: 9
# 
# UIK_country_Loc_24 <- RU_total_UIK %>% 
#     filter(year %in% c(2024)) %>% 
#     mutate(Location = str_trim(Location)) %>%
#     distinct(UIK,en_country,Location)



df_turnout_18_24 <- 
RU_total_UIK %>% 
  filter(year %in% c(2018, 2024)) %>% 
  mutate(Location = str_trim(Location)) %>%
  # rows_patch(UIK_country_Loc_24,by=c("UIK",'en_country')) %>% 
  pivot_wider(id_cols = c(UIK,en_country,Location),
              names_from = year,values_from = total) %>% 
  mutate(diff = `2024`- `2018`, ratio = round(diff/`2018`*100,0)) %>% 
  filter(!is.na(`2024`)) %>%
  left_join(filter(sum_voters,year==2024)) %>% 
  mutate(Location = if_else(is.na(Location),paste0(en_country,'-',as.character(UIK)),Location)) %>% 
  arrange(Location) %>% 
  ungroup() %>% 
  mutate(Location_Y = if_else(Location == lag(Location),paste0(Location,'-',as.character(UIK)),Location)) %>% 
  mutate(Location_Y = if_else(is.na(Location_Y),Location,Location_Y))
  

pal <- c('brown','#0084D7')
pal <- setNames(pal,c('Y','N'))
p <-
  plot_ly(
    df_turnout_18_24 %>% 
      filter(!is.na(ratio)),
    y = ~ reorder(Location_Y, -ratio),
    x = ~ ratio,
    size = ~ `2024`,
    alpha = 0.6,
    color = ~ gov_flag,
    colors=pal,
    text = ~paste("Country: ",en_country,
                  '<br>Location: ', Location_Y,'/',UIK,
                  '<br>Turnout',
                  '<br>  \'18:',`2018`,
                  '<br>  \'24:',`2024` ,
                  '<br>Difference: ', ratio,
                  '%<br>for Putin: ',round(gov_ratio*100,0),'%'),
    hoverinfo = 'text'
  ) %>% 
  add_markers(sizes = c(30,1000))

p %>% layout(yaxis=list(title=""),xaxis=list(title="Difference in turnout 2018-2024, %"),legend = list(orientation = 'h',title = list(text = "Putin won?"),y = 1,x=0.2))
```

```{r sum_ratio_calc}
total_sum <- total_voters %>% group_by(year) %>% summarize(sum = sum(total))
total_gov <- gov_voters %>% group_by(year) %>% summarise(sum_gov = sum(gov_total))

df_fake <- df_turnout_18_24 %>%
  filter(ratio > 506) %>%
  distinct(UIK) %>%
  left_join(gov_voters) %>%
  left_join(sum_voters) %>%
  filter(year==2024) %>% 
  left_join(total_sum) %>% 
  left_join(total_gov) %>% 
  mutate(ratio_total = total/sum,ratio_gov = gov_total/sum_gov) %>% 
  select(UIK,ratio_total,ratio_gov) %>% 
  summarise(sum_ratio = sum(ratio_total),sum_ratio_gov = sum(ratio_gov))
```

В глаза бросаются пять участков справа: Анкара, Молдова, Бангладеш, Кипр и Египет. В них положительная разница в явке более 500%. Суммарно эти участки дают `r round(df_fake$sum_ratio*100,0)` % всех голосов.

Пропускная способность в Зальцбурге была `r round(1437/13/3,0)` человека на одного человека в комисии в час, в Вене `r round(2278/13/6,0)`. Если предположить что скорость в Зальцбурге нормальная, то по количеству проголосовавших людей можно предположить где могли произойти вбросы. На @fig-cum_ratio показаны участки составляющие 60% всех голосующих.

```{r cum_ratio}
#| label: fig-cum_ratio
#| fig-cap: "Locations with 60% contribution to total voters"
#| fig-height: 6
#| 
df_cum_18_24 <- df_turnout_18_24 %>% 
  arrange(-total) %>% 
  mutate(cum_total = cumsum(total)) %>% 
  mutate(cum_ratio = cum_total/380724,ratio = total/380724) 


cum_75plot <-  function(el_year=2024,limit_ratio = 0.75){
  g1 <- df_cum_18_24 %>%
    filter(cum_ratio <= limit_ratio) %>%
    filter(year == el_year) %>%
    ggplot(aes(
      text = paste0(
        "Country: ",
        en_country,
        "<br>People voted: ",
        total,
        "<br>From all: ",
        round(ratio*100, 1),
        "%",
        "<br>Cumulative: ",
        round(cum_ratio * 100, 1),
        "%",
        "<br>Putin result: ",
        round(gov_ratio * 100, 0),
        "%"
      )
    )) +
    geom_col(aes(
      y = ratio,
      x = reorder(Location_Y, -ratio),
      fill = gov_flag
    )) +
    geom_line(
      aes(
        y = cum_ratio,
        group = 1,
        x = reorder(Location_Y, -ratio)
      ),
      color = 'grey20',
      linewidth = 0.1
    ) +
    geom_point(
      aes(y = cum_ratio, x = reorder(Location_Y, -ratio)),
      color = 'grey20',
      size = 1.5,
      alpha = 0.6
    ) +
    theme_minimal_hgrid() +
    labs(y = "Percent from all voters", 
         x = "", 
         title = "Locations with total amount of 60% from all voters",
         fill = "Putin won?") +
    scale_y_continuous(labels = scales::percent_format(accuracy = 1),
                       expand = expansion(0.01, 0)) +
    theme(
      axis.text.x = element_text(
        angle = 90,
        size = 9,
        color = 'grey40'
      ),
      axis.line = element_blank(),
      axis.ticks = element_blank(),
      axis.text.y = element_text(size = 9, color = 'grey40'),
      title = element_text(size = 12, color = 'grey20'),
      axis.title = element_text(size = 10, color = 'grey30')
    )
         

ggplotly(g1,tooltip = 'text')
}
cum_75plot(limit_ratio = 0.6)

```

# Демографический состав голосующих

Среди избирателей за рубежом очень много военных частей или контролируемых Россией квазигосударств (Абхазия, Приднестровье), их результат на выборых обычно предсказуемо выше 70%, @fig-military_fig.

```{r military_calc}

RU_Pro_flag <- RU04_24 %>% 
  distinct(UIK,year,Location,country,en_country) %>% 
  mutate(Location = str_trim(Location)) %>%
  mutate(ru_pro = case_when(
    str_detect(Location,
  'Миноб|ФСБ|батальон|ОКРМС|штаб|в/ч|Матросский|офицеров|ОШК|ДОФ|КСПМ|Батальон|Клуб 1472')~'Military',
    str_detect(country,'Молда|Абха|Осет')~ "Military",
    TRUE ~"Non military")) 

RU04_24_PM <-
  RU04_24 %>% 
  filter(str_detect(Label,'Пу|Ме|yes')) %>% 
  group_by(UIK,Location,en_country,year,region) %>% 
  summarise(rat = mean(ratio), people = sum(number)) #%>%

df_mlt <- RU04_24_PM %>% 
  mutate(Location = str_trim(Location)) %>%
  left_join(RU_Pro_flag,by=join_by(UIK,year,Location,en_country)) %>%
  mutate(year = as.factor(year)) %>%
  arrange(year) %>%
  mutate(rat_bin = cut(rat,seq(0,100,by=5),right = TRUE)) %>% 
  group_by(year,rat_bin,ru_pro) %>% 
  summarise(people_bin = sum(people)) 
  
```

```{r military_fig}
#| label: fig-military_fig
#| fig-cap: "Military controlled voters"
#| fig-height: 9
#| fig-align: 'left'
g1 <- df_mlt %>%
  ggplot(aes(
    x = rat_bin,
    fill = ru_pro,
    text = paste0(
      "Category: ",
      rat_bin,
      "<br>People: ",
      people_bin,
      "<br>",
      ru_pro
    )
  )) +
  geom_col(
    aes(y = people_bin),
    position = position_dodge2(preserve = 'single', padding = 0),
    width = 0.7
  ) +
  scale_fill_manual(values = c('brown','#0084D7')) +
  theme_minimal_hgrid(font_size = 10) +
  facet_grid(year ~ .) +
  labs(x = "votes for Putin %", y = "number of votes for Putin", fill =
         "") +
  scale_y_continuous(
    breaks = c(0, 10000, 30000, 50000, 80000),
    labels = c('0', '10K', '30k', '50K', '80K')
  ) +
  scale_x_discrete(
    labels = c(
      '10',
      '',
      '20',
      '',
      '30',
      '',
      '40',
      '',
      '50',
      '',
      '60',
      '',
      '70',
      '',
      '80',
      '',
      '90',
      '',
      '100'
    )
  ) +
  theme(
    legend.position = 'top',
    axis.line = element_blank(),
    panel.grid.major.y = element_line(
      color = 'grey90',
      linetype = 1,
      linewidth = 0.01
    ),
    axis.title.y = element_text(margin = margin(0,20,0,0))
  )



ggplotly(g1,tooltip = 'text',width = 800) %>% layout(legend=list(orientation='h',xanchor='center',x=0.5,y=1.05))
```

```{r}
#| fig-width: 7
#| fig-height: 9
# g1
```

У Важных историй получилось, что процент военных и квазигосударств [составляет 46%](https://istories.media/news/2024/03/18/bolee-46-golosov-za-putina-na-zarubezhnikh-territoriyakh-polucheno-v-podkontrolnikh-rossii-stranakh-i-voinskikh-chastyakh/), у меня вышло в районе 37% в 2024 @fig-mil_prop.

```{r mil_prop}
#| label: fig-mil_prop
#| fig-cap: "Military controlled voters, %"
g1 <- RU04_24_PM %>%
  mutate(Location = str_trim(Location)) %>%
  left_join(RU_Pro_flag,by=join_by(UIK,year,Location,en_country)) %>%
  group_by(year,ru_pro) %>%
  summarise(people = sum(people)) %>%
  pivot_wider(id_cols = year,names_from = ru_pro,values_from = people) %>%
  mutate(Y_N_ratio = `Military`/(`Military`+`Non military`)) %>% 
  ggplot()+
  geom_col(aes(x=year,y=Y_N_ratio),fill='brown')+
  geom_text(aes(x=year,label=paste0(round(Y_N_ratio*100,0),"%"),y=Y_N_ratio*0.92),vjust = 1.5,color='grey99')+
  theme_minimal_hgrid(font_size = 10)+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  labs(title="Military or controlled territories among voters abroad",x="",y="")+
  scale_x_continuous(breaks = c(2004,2008,2012,2018,2020,2024))+
  theme(axis.line = element_blank(),
        axis.ticks = element_blank())

g1
```

# Динамика голосования

Изменение распределения

Кто пришел когда, кто придет в 2030?
