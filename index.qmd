---
title: "Выборы в России из-за границы"
execute:
  echo: false 
  warning: false
subtitle: "Как голосуют на российских выборах граждане РФ проживающие за границей"
author: "Илья Тищенко"
---

# Введение

В 2020 году мне стало интересно, как проголосовала заграница на референдуме по изменению конституции. В результате, родилась [вот такая](https://rpubs.com/vearlen/obnulis "Результаты российского референдума 2020 года") короткая заметка. В связи с предстоящими выборами (начал я писать до) я решил посмотреть ретроспективно на прошедшие выборы. Я не журналист, просто люблю находить какие-то смыслы с помощью данных. В этот раз вышло немного больше чем в 20-ом. \
Если есть какие-то мысли пишите мне в телеграм @vearlen.

# Общие сведения

```{r libraries}
#| echo: false
#| warning: false
library(tidyverse)
library(plotly)
library(cowplot)
library(ggstar)
library(DT)
library('ggrepel')
#ratio_all  <-  round(1890863/112309947*100,1)
#ratio_eu <- round(679028/112309947*100,1)
```

В 2024 году за пределами России проживает 1 890 863[^1] избирателя, это 1.7% от всех избирателей.

[^1]: [Интерфакс, кол-во избирателей в России](https://www.interfax.ru/russia/944186)

### Явка

Явку оценить довольно сложно, т.к. сведения о проживающих в разных странах не всегда совпадают с годом голосования[^2] и не всегда легко доступны. Ниже приведенный график дает общее представление, разброс явки от 2 до 70%. Лидируют Республика Молдова, Латвия, Литва, Греция, Эстония.

[^2]: [Граждане РФ в Латвии](https://lz.lv/p/v-latvii-poschitali-grazhdan-rf-eto-kazhdyi-piatidesiatyi-zhitel-672177)

```{r turnout}
#| echo: false
#| warning: false
#| fig-height: 7
turnout18 <- read.csv('Data/2018_voted.csv',sep = ';',dec = ',')


g1 <- turnout18 %>%
  filter(!is.na(vote_ratio)) %>%
  ggplot(aes(x = reorder(en_country, -vote_ratio), y = vote_ratio*100,
             text = paste0("страна: ", en_country,
                           "<br>явка: ",vote_ratio*100,"%",
                           "<br>всего: ", total_rus,
                           "<br>голосовало: ", sum))) +
  geom_col(width=0.7, fill='#558261') +
  coord_flip() +
  theme_cowplot() +
  labs(x = "", y = "Явка на выборах 2018")+
  theme(axis.line.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_blank())+
  scale_y_continuous(expand = expansion(0.01,0.1))

ggplotly(g1,tooltip = 'text')

```

Явка в Австрии 7% или 14%, последняя если считать относительно проживающих в Вене. На последние выборы президента в 2018 году в Вене пришло 2248 человека, в Австрии в 2018 году проживало 32 429[^3] человека с российским гражданством из них примерно 50% живет в Вене.

[^3]: [Сколько россиян проживает в Австрии](https://www.integrationsfonds.at/fileadmin/user_upload/Fact_Sheet_41_Russische_Bevo__lkerung_V3.pdf)

# Где живет большинство

Как же распределены граждане РФ за рубежом? Например, в Европе проживает в районе 679 028 человек, 0.6% от всех избирателей и 35% от всех проживающих за рубежом. Больше всего в Европе россиян живет в Германии - 237 816, 35% от всех "европейцев".

Ниже показаны страны, составляющие 75% от всех проголосовавших по годам.

```{r countries input}
RU04_20 <- read.csv("Data/RU04_20_Russia.csv")
RU_total <- RU04_20 %>% 
  # filter(region == "Europe") %>%
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(year) %>% 
  summarise(total = sum(number)) 

# cumulative add to total voters
RU_cumsum <- RU04_20 %>% 
  # filter(region == "Europe") %>% 
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(en_country,year) %>% 
  summarise(cntr_total = sum(number)) %>% 
  arrange(-cntr_total) %>% 
  left_join(RU_total) %>% 
  mutate(ratio = round((cntr_total/total)*100,4)) %>%
  group_by(year) %>% 
  mutate(cum_rat = cumsum(ratio),cum_num = cumsum(cntr_total),index = row_number()) 

cum_75plot <-  function(el_year=2004){
g1 <- RU_cumsum %>% 
  filter(cum_rat <= 75) %>% 
  filter(year==el_year) %>% 
 mutate(en_country = if_else(grepl("America",en_country),"USA",en_country)) %>%
  ggplot(aes(
    text = paste0(
      "страна: ", en_country,
      "<br>кол-во проголосовавших: ", cntr_total,
      "<br>от всех избирателей: ", round(ratio,0),"%",
      "<br>накопленный процент: ", round(cum_rat,0),"%",
      "<br>накопленное кол-во проголосовавших/всего: ", cum_num," / ", total 
    )))+
  geom_col(aes(y=ratio,x=reorder(en_country,-ratio)))+
  geom_line(aes(y=cum_rat,group=1,x=reorder(en_country,-ratio)))+
             # facet_grid(.~year)+
             theme_minimal_hgrid()+
             labs(y="",x="",title=el_year)+
  theme(axis.text.x = element_text(angle=90))
         

ggplotly(g1,tooltip = 'text')
}

```

```{r}
cum_75plot(el_year = 2004)
```

```{r 2008}
cum_75plot(el_year = 2008)
```

До 2012 года первой по вкладу была Грузия, потом она исчезла. Появились Абхазия и Осетия.

```{r 2012}
cum_75plot(el_year = 2012)
```

В 2018 исчезла Украина и кол-во стран набирающих 75% выросло до 18, в 2008 их было 10.

```{r 2018}
cum_75plot(el_year = 2018)

```

В 2020 году в топ 75% появилась Сирия.

```{r 2020}
cum_75plot(el_year = 2020)
```

В целом в любой год топ 5 стран дают почти 50% избирателей за рубежом и эти топ пять это:

```{r}
RU_cumsum %>% 
  filter(index <=5) %>% 
  select(en_country,year,cum_rat) %>% 
  arrange(year,cum_rat) %>% 
  select(-cum_rat) %>% 
  pivot_wider(names_from = year,values_from = en_country) %>% 
  unnest() %>% 
  datatable(options = list(pageLength = 5, dom = 'tip'), rownames = FALSE)
  
```

# Как голосует Европа

```{r}
#| echo: false
#| warning: false
#| fig-width: 10
#| fig-height: 6
#| fig-align: center





# official results PU, ME, Referendum
pu <- tibble(year=c(2004,2008,2012,2018,2020),rat=c(71.3,70.28,63.6,76.7,78.45),
             en_country = rep("Официальный результат 
выборов в РФ",5))
 

# clean up data, leave only PU and ME
RU04_20_PM <-
  RU04_20 %>% 
  filter(str_detect(Label,'Пу|Ме|yes')) %>% 
  group_by(en_country,year,region) %>% 
  summarise(rat = mean(ratio)) %>% 
  filter(region == "Europe") %>% 
  # distinct(en_country) %>% View()
  mutate(color = case_when(
    en_country == "Austria" ~ "red",
    en_country == "Netherlands" ~ "forestgreen",
                         TRUE ~"grey80")
    )

test <- RU04_20_PM %>% 
  filter(year==2012) %>% 
  distinct(en_country) %>% tail() %>% list()


# test[[1]][6,2]


g1 <- RU04_20_PM %>%
  ggplot(aes(x = year, y = rat, label = en_country)) +
  geom_hline(yintercept = 50,
             linewidth = 0.2,
             color = 'grey20') +
  geom_text_repel(
    data = filter(RU04_20_PM,
                  year == 2012,
                  en_country %in% c("Austria")),
    color = 'red',
    segment.curvature = -0.1,
    segment.ncp = 1,
    segment.angle = 90,
    box.padding = 3,
    min.segment.length = 0,
    size=5,
    # fontface='bold',
    nudge_x = -0.1
  ) +
  geom_text_repel(
    data = filter(RU04_20_PM,
                  year == 2012,
                  en_country %in% c(test[[1]][6,2])),
    color = 'grey30',
    size=5,
    segment.curvature = -0.5,
    segment.ncp = 4,
    segment.angle = 90,
    box.padding = 1.4,
    min.segment.length = 1,
    nudge_x = -0.1,
    # nudge_y = -1,
    segment.shape=1
  ) +
  geom_text_repel(
    data = filter(pu,
                  year == 2012),
    color = '#636201',
    size=5,
    nudge_x=1,
    nudge_y=-8,
    hjust=0,
    segment.curvature = -0.1,
    segment.ncp = 2,
    segment.angle = 90,
    box.padding = 1,
    min.segment.length = 0
  ) +
  geom_jitter(
    aes(group = en_country),
    width = 0.2,
    size = 2.5,
    alpha =0.9,
    color = 'grey10',
    shape=21,
    fill = 'grey80'
  ) +
  geom_star(
    data = pu,
    color = 'brown4',
    size = 6,
    alpha = 0.9,
    fill = 'yellow'
  ) +
  geom_jitter(
    data = filter(RU04_20_PM, en_country == "Austria"),
    aes(group = en_country),
    width = 0,
    size = 4,
    alpha = 0.8,
    color = 'black',
    fill = 'red',
    shape = 21
  ) +
  geom_jitter(
    data = filter(RU04_20_PM, en_country == test[[1]][6,2]),
    aes(group = en_country),
    width = 0,
    height = 0,
    size = 4,
    alpha = 0.8,
    color = 'black',
    fill = 'green3',
    shape = 21
  ) +
  theme_minimal() +
  scale_color_identity() +
  scale_x_continuous(breaks = c(2004, 2008, 2012, 2018, 2020)) +
  scale_y_continuous(breaks = seq(20, 100, by = 10)) +
  labs(
    x = "",
    y = "%",
    title = "Как Европа голосовала на выборах президента РФ, референдуме 2020",
    subtitle = "каждая точка - процент голосов в отдельной европейской стране за Путина/Медведева
и за изменение конституции в 2020 году",
    caption = "Источник данных: ЦИК России
Сбор данных и визуализация: И. Тищенко"
  ) +
  
  theme(
    axis.line.x = element_line(color = 'grey80', linewidth = .0),
    axis.ticks.x = element_line(color = 'grey80', linewidth = 0.0),
    axis.text.x.bottom = element_text(size = 12, color = 'grey50',
                                      margin = margin(-10,10,0,40)) ,
    axis.text.y = element_text(size = 12),
    panel.grid = element_blank(),
    axis.title.y = element_text(
      angle = 0,
      vjust=0.95,
      hjust=0.1,
      size=13,
      margin = margin (0,-12,0,20)),
    # panel.grid.major.x = element_line(color='grey70',linetype =5, linewidth = 0.3),
    panel.grid.major.y = element_line(
      color = 'grey80',
      linetype = 5,
      linewidth = 0.3
    ),
    axis.text.x = element_blank(),
    plot.title = element_text(hjust = 0, size = 17, face = 'bold'),
    plot.caption = element_text(
      size = 12,
      color = 'grey50',
      face =  'italic',
      margin = margin(0, 0, 0, 0)
    ),
    plot.subtitle = element_text(
      size = 14,
      color = 'grey30',
      hjust = 0
    ),
    legend.background = element_rect(fill = alpha('white', 0.8), colour = 'white'),
    legend.title = element_blank()
  )

g1
```
