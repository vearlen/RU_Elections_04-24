---
title: "Выборы в России из-за границы"
execute:
  echo: false 
  warning: false
subtitle: "Как голосуют на российских выборах граждане РФ проживающие за границей"
author: "Илья Тищенко"
---

# Коротко

В 2020 году мне стало интересно, как проголосовала заграница на референдуме по изменению конституции. В результате, родилась [вот такая](https://rpubs.com/vearlen/obnulis "Результаты российского референдума 2020 года") короткая заметка. В связи с предстоящими выборами (начал я писать до) я решил посмотреть ретроспективно на прошедшие выборы. Количество избирателей за границей порядка 1.7% от всех избирателей. Явка в странах за границей сильно варьирует от 2 до 70%, причем она *выше там где больше про-правительственных* избирателей, но есть ньюансы. Топ пять стран (50% от всех избирателей) это бывшие советские республики: Грузия, Молдова, Эстония, Украина, Латвия, Беларусь. Поэтому очень важно понимать, что мы или кто-то другой имеет в виду когда говорит "российский изибратель за границей", т.к. часто и они составляют большинство это либо военные, либо люди на территории с российским военным присутствием.

Если же задаться вопросом и рассмотреть заграничные страны как некий референс отношения к текущей ситуации в России в каждый конкретный момент, то нужно выбрать эти страны аккуратно.

Я не журналист, просто люблю находить какие-то смыслы с помощью данных. В этот раз вышло немного больше чем в 20-ом. Дальше длинный текст. Если есть какие-то мысли пишите мне в телеграм @vearlen.

# Общие сведения

```{r libraries}
#| echo: false
#| warning: false
library(tidyverse)
library(plotly)
library(cowplot)
library(ggstar)
library(DT)
library('ggrepel')
library(modelsummary)
options(scipen = 999)
RU04_20 <- read.csv("Data/RU04_20_Russia.csv", sep=";")

# official results PU, ME, Referendum
pu <- tibble(year=c(2004,2008,2012,2018,2020),
             rat=c(71.3,70.28,63.6,76.7,78.45),
             en_country = rep("Официальный результат 
выборов в РФ",5)) %>% 
  mutate(rat_dec = rat*0.01)
#ratio_all  <-  round(1890863/112309947*100,1)
#ratio_eu <- round(679028/112309947*100,1)
```

В 2024 году за пределами России проживает 1 890 863[^1] избирателя, это 1.7% от всех избирателей. Если взять число проголосовавших в 2018 году (474366) то получится что в среднем голосует 25%.

[^1]: [Интерфакс, кол-во избирателей в России](https://www.interfax.ru/russia/944186)

### Явка

Подробную явку оценить довольно сложно, т.к. сведения о проживающих в разных странах не всегда совпадают с годом голосования[^2] и не всегда легко доступны и достоверны. Ниже приведенный график дает общее представление, разброс явки от 2 до 70%. Лидируют: Республика Молдова, Латвия, Литва, Греция, Эстония, бывшие советские республики.

[^2]: [Граждане РФ в Латвии](https://lz.lv/p/v-latvii-poschitali-grazhdan-rf-eto-kazhdyi-piatidesiatyi-zhitel-672177)

```{r turnout}
#| echo: false
#| warning: false
#| fig-height: 7
turnout18 <- read.csv('Data/2018_voted.csv',sep = ';',dec = ',')


g1 <- turnout18 %>%
  filter(!is.na(vote_ratio)) %>%
  ggplot(aes(x = reorder(en_country, -vote_ratio), y = vote_ratio*100,
             text = paste0("страна: ", en_country,
                           "<br>явка: ",vote_ratio*100,"%",
                           "<br>всего: ", total_rus,
                           "<br>голосовало: ", sum))) +
  geom_col(width=0.7, fill='#0084D7') +
  coord_flip() +
  theme_cowplot() +
  labs(x = "", y = "Явка на выборах 2018")+
  theme(axis.line.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_blank())+
  scale_y_continuous(expand = expansion(0.01,0.1))

ggplotly(g1,tooltip = 'text')

```

Явка в Австрии 7% или 14%, последняя если считать относительно проживающих в Вене. На последние выборы президента в 2018 году в Вене пришло 2248 человека, в Австрии в 2018 году проживало 32 429[^3] человека с российским гражданством из них примерно 50% живет в Вене.

[^3]: [Сколько россиян проживает в Австрии](https://www.integrationsfonds.at/fileadmin/user_upload/Fact_Sheet_41_Russische_Bevo__lkerung_V3.pdf)

# Где живет большинство

Как же распределены граждане РФ за рубежом? Например, в Европе проживает в районе 679 028 человек, 0.6% от всех избирателей и 35% от всех проживающих за рубежом. Больше всего в Европе россиян живет в Германии - 237 816, 35% от всех "европейцев". Голосует в Германии тоже в районе 14%, на выборах 2018 проголосовали 33479 человека.

### Как менялось количество и динамика голосования

В целом кол-во голосующих с 2004 года росло, за исключением референдума 2020 года, на который пришло в два раза меньше чем на выборы 18-го.

```{r total voters function}
total_voters <- function(sel_region = NA, sel_country = NA){
if(is.na(sel_region)){
  sel_region = all_of(RU04_20$region)
  sel_region_label = NULL
}  else {
  sel_region
  sel_region_label = sel_region
}

if(is.na(sel_country)){
  sel_country = all_of(RU04_20$en_country) 
  sel_country_label = NULL
} else {
  sel_country
  sel_country_label = sel_country
}  
total_voters <- RU04_20 %>% 
  filter(region %in% c(sel_region)) %>%
  filter(en_country %in% c(sel_country)) %>%
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(year) %>% 
  summarise(total = sum(number))

g1 <- total_voters %>% 
  ggplot(aes(x=year,y=total))+
  geom_bar(position = 'stack',stat='identity',fill='#0084D7')+
  geom_text(aes(label=total,y=total*0.92),vjust = 1.5,color='grey20')+
  theme_cowplot()+
  theme_minimal_hgrid()+
  labs(y="",x="",fill="",title=paste0("Кол-во проголосовавших ",sel_region_label,"  ",sel_country_label),
       subtitle= "Кол-во проголосовавших за рубежом")+
  scale_x_continuous(breaks = c(2004,2008,2012,2018,2020))+
  theme(legend.position = 'top',
        axis.line.x = element_blank(),
        axis.ticks.x = element_blank(),
        plot.subtitle = element_text(size=12,color='grey70',hjust=1))
# g1
ggplotly(g1)
}
```

```{r}
total_voters()
```

```{r all votes}

voters_total <- function(sel_region = NA, sel_country = NA){
  
  if(is.na(sel_region)){
    sel_region = all_of(RU04_20$region)
    sel_region_label = NULL
  }  else {
    sel_region
    sel_region_label = sel_region
  }
  
  if(is.na(sel_country)){
    sel_country = all_of(RU04_20$en_country) 
    sel_country_label = NULL
  } else {
    sel_country
    sel_country_label = sel_country
  }  
  
  total_voters <- RU04_20 %>% 
    filter(region %in% c(sel_region)) %>% 
    filter(en_country %in% c(sel_country)) %>%
    filter(Label %in% c("Число недействительных избирательных бюллетеней",
                        "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
    group_by(year) %>% 
    summarise(total = sum(number))
  
  
  gov_voters <- RU04_20 %>% 
    filter(region %in% c(sel_region)) %>% 
    filter(en_country %in% c(sel_country)) %>%
    filter(Label %in% c("yes",
                        "Путин Владимир Владимирович",
                        "Медведев Дмитрий Анатольевич"
    )) %>%
    group_by(year) %>% 
    summarize(gov_total = sum(number))
  
  reject_voters <- RU04_20 %>% 
    filter(region == sel_region) %>% 
    filter(en_country %in% c(sel_country)) %>%
    filter(Label %in% c("Rejected.ballots",
                        "Число недействительных избирательных бюллетеней")) %>% 
    group_by(year) %>% 
    summarize(reject_total = sum(number))
  
  against_voters <- RU04_20 %>% 
    filter(region %in% c(sel_region)) %>% 
    filter(en_country %in% c(sel_country)) %>%
    filter(Label %in% c("Глазьев Сергей Юрьевич",
                        "Против всех",
                        "Малышкин Олег Александрович",
                        "Миронов Сергей Михайлович",
                        "Хакамада Ирина Муцуовна",
                        "Харитонов Николай Михайлович",
                        "Богданов Андрей Владимирович",
                        "Жириновский Владимир Вольфович",
                        "Зюганов Геннадий Андреевич",
                        "Прохоров Михаил Дмитриевич",
                        "Бабурин Сергей Николаевич",
                        "Грудинин Павел Николаевич",
                        "Собчак Ксения Анатольевна",
                        "Сурайкин Максим Александрович",
                        "Титов Борис Юрьевич",
                        "Явлинский Григорий Алексеевич",
                        "no")) %>% 
    group_by(year) %>% 
    summarize(against_total = sum(number))
  
  
  sum_voters <- total_voters %>% 
    left_join(gov_voters) %>% 
    left_join(reject_voters) %>% 
    left_join(against_voters) %>% 
    mutate(gov_ratio = gov_total/total,
           reject_ratio = reject_total/total,
           against_ratio = against_total/total)
  
  
  
  g1 <- sum_voters %>% 
    select(year,gov_total,reject_total,against_total) %>% 
    pivot_longer(-year,names_to = "category",values_to = 'ratio') %>% 
    mutate(category = case_when(
      category == "gov_total" ~ "про-правительственный голос",
      category == "against_total" ~ "голос против правительства",
      category == "reject_total" ~ "испорченный",
      TRUE~category
    )) %>% 
    ggplot()+
    geom_bar(aes(x=year,
                 y=ratio,
                 fill=category), 
                 position = 'fill', 
                 stat = 'identity')+
    geom_point(data = pu,
               aes(x=year,y=rat_dec),
               size = 4,
               alpha = 0.9,
               color = 'yellow'
    ) +
    scale_fill_manual(values = c('#0084D7','#005082','#8c190f'))+
    theme_cowplot()+
    theme_minimal_hgrid()+
    scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
    labs(y="",x="",fill="",title=paste0("Процент голосующих ",sel_region_label,"  ",sel_country_label))+
    theme(legend.position = 'top',
          axis.line.x = element_blank(),
          axis.ticks.x = element_blank())+
    scale_x_continuous(breaks = c(2004,2008,2012,2018,2020))
  
  ggplotly(g1) %>%  
    plotly::layout(legend=list(x=0, 
                               xanchor='left',
                               yanchor='top',
                               orientation='h'))
}


```

Если посмотреть в целом на распределение голосующих за рубежом, то по сравнению с официальными результатами (показаны желтой точкой) результаты выше за Путина/Медведева. Единственное исключение - референдум 20-го года, 70 % против официальных 78%.

```{r voters all ratio}
voters_total()
```

Если смотреть на европу в целом как на регион, картина такая же.

```{r voters europe ratio}

voters_total(sel_region = 'Europe')

```

При том что некоторые страны довольно разительно отличаются от официального результата, см. ниже результат Великобритании. Тут после 12 года результат голосования значительно ниже официального.

```{r}
voters_total(sel_country = 'United Kingdom')

```

А как обстоят дела в Германии? Где живет больше всего российских европейцев. Тут наблюдается интересный тренд, в 2012 году результат у Путина ниже официального, а в 18-ом снова поднялся и даже стал больше. В 20-ом же вновь разрыв довольно большой.

```{r germany}
voters_total(sel_country = 'Germany')

```

Давайте попробуем понять, за счет чего в среднем по за границе результат получается выше, чем официальный. Ниже показаны страны, составляющие 75% от **всех** **проголосовавших** по годам.

```{r countries input}

RU_total <- RU04_20 %>% 
  # filter(region == "Europe") %>%
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(year) %>% 
  summarise(total = sum(number)) 

# cumulative add to total voters
RU_cumsum <- RU04_20 %>% 
  # filter(region == "Europe") %>% 
  filter(Label %in% c("Число недействительных избирательных бюллетеней",
                      "Число действительных избирательных бюллетеней","Ballots.in.box")) %>% 
  group_by(en_country,year) %>% 
  summarise(cntr_total = sum(number)) %>% 
  arrange(-cntr_total) %>% 
  left_join(RU_total) %>% 
  mutate(ratio = round((cntr_total/total)*100,4)) %>%
  group_by(year) %>% 
  mutate(cum_rat = cumsum(ratio),cum_num = cumsum(cntr_total),index = row_number()) 

cum_75plot <-  function(el_year=2004){
g1 <- RU_cumsum %>% 
  filter(cum_rat <= 75) %>% 
  filter(year==el_year) %>% 
 mutate(en_country = if_else(grepl("America",en_country),"USA",en_country)) %>%
  ggplot(aes(
    text = paste0(
      "страна: ", en_country,
      "<br>кол-во проголосовавших: ", cntr_total,
      "<br>от всех избирателей: ", round(ratio,0),"%",
      "<br>накопленный процент: ", round(cum_rat,0),"%",
      "<br>накопленное кол-во проголосовавших/всего: ", cum_num," / ", total 
    )))+
  geom_col(aes(y=ratio,x=reorder(en_country,-ratio)),fill='#0084D7')+
  geom_line(aes(y=cum_rat,group=1,x=reorder(en_country,-ratio)),color='grey40')+
  geom_point(aes(y=cum_rat,x=reorder(en_country,-ratio)),color='grey40')+         
             theme_minimal_hgrid()+
             labs(y="",x="",title=el_year)+
  theme(axis.text.x = element_text(angle=90))
         

ggplotly(g1,tooltip = 'text')
}

```

Как видно в 2004 году лидируют Грузия, Республика Молдова, Эстония, Украина - 45% в сумме.

```{r}
cum_75plot(el_year = 2004)
```

В 2008 это Грузия, Молдова, Эстония, Украина - 56% в сумме.

```{r 2008}
cum_75plot(el_year = 2008)
```

В 2012 году по понятным причинам Грузия исчезла появились Абхазия и Осетия. В топ шесть стран, составляющих 52% от проголосовавших, впервые попала Германия.

```{r 2012}
cum_75plot(el_year = 2012)
```

В 2018 исчезла Украина и кол-во стран набирающих 75% выросло до 18, для сравнения в 2008 их было 10. Германия переместилась на третье место по количеству проголосовавших. По-прежнему в пятерку в основном входят страны бывшие советские республики.

```{r 2018}
cum_75plot(el_year = 2018)

```

В 2020 году в топ 75% появилась Сирия, хотя на этим голосовании людей проголосовавших было на 60% меньше, чем в 2018 году.\

```{r 2020}
cum_75plot(el_year = 2020)
```

В целом в любой год топ 5 стран дают почти 50% избирателей за рубежом и эти топ пять это:

```{r}
RU_cumsum %>% 
  filter(index <=5) %>% 
  select(en_country,year,cum_rat) %>% 
  arrange(year,cum_rat) %>% 
  select(-cum_rat) %>% 
  pivot_wider(names_from = year,values_from = en_country) %>% 
  unnest() %>% 
  datatable(options = list(pageLength = 5, dom = 'tip'), rownames = FALSE)
  
```

Так что когда вам говорят россияне проголосовавшие за рубежом будьте внимательны. Республика Молдова с 80000 проголосовавших, это военные части в Приднестровье. В Грузии в 2004 и 2008 году очень много участков на территории минобороны. Эстония и Латвия - там, по-видимому, действительно ходят голосвать про-российски настроенные граждане. И их там, судя по всему, много - явка 39% и 55% соответственно.

# Как же голосует Европа?

Наконец-то мы подобрались к этому вопросу. Наверное учитывая выше сказанное нужно определиться в терминологии. Точнее нужно выбрать страны, на которые мы будем смотреть как на ~~прекрасную Россию будущего~~ те места, где люди голосуют как думают. При этом не следует забывать, что частью избирательного процесса является - конкуренция на выборах, альтернативные кандидаты, т.е. всё чего нет даже у тех кто живет за границей. По сути они выбирают между Путиным и остальным. Как написал Владимир Пастухов: "На тоталитарных выборах без выбора есть только две формы протеста: пассивная -- не приходить на выборы и активная -- прийти и испортить бюллетень. Все остальное от лукавого."

```{r}
#| echo: false
#| warning: false
#| fig-width: 10
#| fig-height: 6
#| fig-align: center


 

# clean up data, leave only PU and ME
RU04_20_PM <-
  RU04_20 %>% 
  filter(str_detect(Label,'Пу|Ме|yes')) %>% 
  group_by(en_country,year,region) %>% 
  summarise(rat = mean(ratio)) %>% 
  # filter(region == "Europe") %>%
  mutate(color = case_when(
    en_country == "Austria" ~ "red",
    en_country == "Netherlands" ~ "forestgreen",
                         TRUE ~"grey80")
    )

test <- RU04_20_PM %>% 
  filter(year==2012) %>% 
  distinct(en_country) %>% tail() %>% list()


# test[[1]][6,2]


g1 <- RU04_20_PM %>%
  ggplot(aes(x = year, y = rat, label = en_country)) +
  geom_hline(yintercept = 50,
             linewidth = 0.2,
             color = 'grey20') +
  geom_text_repel(
    data = filter(RU04_20_PM,
                  year == 2012,
                  en_country %in% c("Austria")),
    color = 'red',
    segment.curvature = -0.1,
    segment.ncp = 1,
    segment.angle = 90,
    box.padding = 3,
    min.segment.length = 0,
    size=5,
    # fontface='bold',
    nudge_x = -0.1
  ) +
  geom_text_repel(
    data = filter(RU04_20_PM,
                  year == 2012,
                  en_country %in% c(test[[1]][6,2])),
    color = 'grey30',
    size=5,
    segment.curvature = -0.5,
    segment.ncp = 4,
    segment.angle = 90,
    box.padding = 1.4,
    min.segment.length = 1,
    nudge_x = -0.1,
    # nudge_y = -1,
    segment.shape=1
  ) +
  geom_text_repel(
    data = filter(pu,
                  year == 2012),
    color = '#636201',
    size=5,
    nudge_x=1,
    nudge_y=-8,
    hjust=0,
    segment.curvature = -0.1,
    segment.ncp = 2,
    segment.angle = 90,
    box.padding = 1,
    min.segment.length = 0
  ) +
  geom_jitter(
    aes(group = en_country),
    width = 0.2,
    size = 2.5,
    alpha =0.9,
    color = 'grey10',
    shape=21,
    fill = 'grey80'
  ) +
  geom_star(
    data = pu,
    color = 'brown4',
    size = 6,
    alpha = 0.9,
    fill = 'yellow'
  ) +
  geom_jitter(
    data = filter(RU04_20_PM, en_country == "Austria"),
    aes(group = en_country),
    width = 0,
    size = 4,
    alpha = 0.8,
    color = 'black',
    fill = 'red',
    shape = 21
  ) +
  geom_jitter(
    data = filter(RU04_20_PM, en_country == test[[1]][6,2]),
    aes(group = en_country),
    width = 0,
    height = 0,
    size = 4,
    alpha = 0.8,
    color = 'black',
    fill = 'green3',
    shape = 21
  ) +
  theme_minimal() +
  scale_color_identity() +
  scale_x_continuous(breaks = c(2004, 2008, 2012, 2018, 2020)) +
  scale_y_continuous(breaks = seq(20, 100, by = 10)) +
  labs(
    x = "",
    y = "%",
    title = "Как Европа голосовала на выборах президента РФ, референдуме 2020",
    subtitle = "каждая точка - процент голосов в отдельной европейской стране за Путина/Медведева
и за изменение конституции в 2020 году",
    caption = "Источник данных: ЦИК России
Сбор данных и визуализация: И. Тищенко"
  ) +
  
  theme(
    axis.line.x = element_line(color = 'grey80', linewidth = .0),
    axis.ticks.x = element_line(color = 'grey80', linewidth = 0.0),
    axis.text.x.bottom = element_text(size = 12, color = 'grey50',
                                      margin = margin(-10,10,0,40)) ,
    axis.text.y = element_text(size = 12),
    panel.grid = element_blank(),
    axis.title.y = element_text(
      angle = 0,
      vjust=0.95,
      hjust=0.1,
      size=13,
      margin = margin (0,-12,0,20)),
    # panel.grid.major.x = element_line(color='grey70',linetype =5, linewidth = 0.3),
    panel.grid.major.y = element_line(
      color = 'grey80',
      linetype = 5,
      linewidth = 0.3
    ),
    axis.text.x = element_blank(),
    plot.title = element_text(hjust = 0, size = 17, face = 'bold'),
    plot.caption = element_text(
      size = 12,
      color = 'grey50',
      face =  'italic',
      margin = margin(0, 0, 0, 0)
    ),
    plot.subtitle = element_text(
      size = 14,
      color = 'grey30',
      hjust = 0
    ),
    legend.background = element_rect(fill = alpha('white', 0.8), colour = 'white'),
    legend.title = element_blank()
  )

g1
```

# Есть ли связь между явкой и процентом?

```{r}
RU18_res <- 
  RU04_20 %>% 
  filter(str_detect(Label,'Пу|Ме|yes')) %>% 
  group_by(en_country,year,region) %>% 
  summarise(rat = mean(ratio)) %>% 
  filter(year==2018) %>% 
  select(en_country,year,rat) %>% 
  mutate(result = rat*0.01) %>% 
  select(-rat)

turn18_clean <- turnout18 %>% 
  filter(!is.na(vote_ratio)) %>% 
  mutate(turnout = vote_ratio) %>% 
  select(en_country, turnout)
  

turnout_results18 <- turn18_clean %>%  
  left_join(RU18_res)

g1 <- turnout_results18 %>% 
  ggplot(aes(x=turnout,y=result,label = en_country))+
  geom_point()+
  geom_smooth(method = 'lm')+
  theme_minimal_grid()
  # geom_abline(slope = 1)
# g1
ggplotly(g1)
```

# 

```{r}

fit <- lm(result~turnout, turnout_results18)
summary(fit)
```
